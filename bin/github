#!/usr/bin/env ruby

`git ls-files >& /dev/null`
$?.exitstatus == 0 or raise "Not in git repository"

origin = `git config remote.origin.url`.chomp
if origin.start_with? "git"
  # git@github.com:username/repo.git
  slug = origin.split(':').last.gsub('.git', '')
  base = "https://github.com/#{slug}"
else
  # https://github.com/username/repo.git
  base = origin.gsub('.git', '')
end

branch = `git rev-parse --abbrev-ref HEAD`
url    = "#{base}/tree/#{branch}"

`open #{url}`
